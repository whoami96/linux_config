// ============================================================================
// LogiOps configuration — Logitech MX Master 3
// Author: Paweł Owczarczyk (WhoAmI)
// Date: 2025-08-24
// Host OS: Fedora (GNOME)
// Location: /etc/logid.cfg
//
// Notes:
// - Gestures use "OnRelease" mode (press action when gesture is released).
// - Thumb wheel is diverted to LogiOps for custom actions.
// - Safe defaults; tweak DPI/smartshift to taste.
// ============================================================================

devices: ({

  // Exact device name as reported by logid in debug mode
  name: "Wireless Mouse MX Master 3";

  // --- Scrolling behavior ----------------------------------------------------
  smartshift: {
    on: true;           // enable SmartShift (auto free-spin)
    threshold: 15;      // 1–255, lower = easier free-spin
    // default_threshold: 15; // uncomment to set device default
  };

  hiresscroll: {
    hires: true;        // high-resolution scrolling
    invert: false;      // normal direction
    target: false;      // set true only if you plan to remap wheel up/down
  };

  // --- Pointer speed ---------------------------------------------------------
  dpi: 1500;            // MX Master 3 supports up to 4000

  // --- Thumb wheel (horizontal) ----------------------------------------------
  // Divert thumb wheel so LogiOps can handle it.
  // Default: switch app/browser tabs (Ctrl+PageUp/PageDown).
  thumbwheel: {
    divert: true;
    invert: false;

    left: {
      mode: "OnRelease";
      action = {
        type: "Keypress";
        keys: [ "KEY_LEFTCTRL", "KEY_PAGEUP" ];
      };
    };

    right: {
      mode: "OnRelease";
      action = {
        type: "Keypress";
        keys: [ "KEY_LEFTCTRL", "KEY_PAGEDOWN" ];
      };
    };
  };

  // --- Buttons & gestures ----------------------------------------------------
  buttons: (

    // Forward button
    {
      cid: 0x56;
      action = {
        type: "Gestures";
        gestures: (
          {
            direction: "None";
            mode: "OnRelease";
            action = { type: "Keypress"; keys: [ "KEY_FORWARD" ]; };
          },
          {
            direction: "Up";
            mode: "OnRelease";
            action = { type: "Keypress"; keys: [ "KEY_PLAYPAUSE" ]; };
          },
          {
            direction: "Down";
            mode: "OnRelease";
            action = { type: "Keypress"; keys: [ "KEY_LEFTMETA" ]; };
          },
          {
            direction: "Right";
            mode: "OnRelease";
            action = { type: "Keypress"; keys: [ "KEY_NEXTSONG" ]; };
          },
          {
            direction: "Left";
            mode: "OnRelease";
            action = { type: "Keypress"; keys: [ "KEY_PREVIOUSSONG" ]; };
          }
        );
      };
    },

    // Back button
    {
      cid: 0x53;
      action = {
        type: "Gestures";
        gestures: (
          {
            direction: "None";
            mode: "OnRelease";
            action = { type: "Keypress"; keys: [ "KEY_BACK" ]; };
          }
        );
      };
    },

    // Gesture button (hold + move)
    {
      cid: 0xc3;
      action = {
        type: "Gestures";
        gestures: (
          {
            direction: "None";
            mode: "OnRelease";
            action = { type: "Keypress"; keys: [ "KEY_LEFTMETA" ]; }; // Activities
          },
          {
            direction: "Right";
            mode: "OnRelease";
            action = { type: "Keypress"; keys: [ "KEY_LEFTMETA", "KEY_PAGEDOWN" ]; }; // switch workspace right
          },
          {
            direction: "Left";
            mode: "OnRelease";
            action = { type: "Keypress"; keys: [ "KEY_LEFTMETA", "KEY_PAGEUP" ]; };   // switch workspace left
          },
          {
            direction: "Up";
            mode: "OnRelease";
            action = { type: "Keypress"; keys: [ "KEY_LEFTMETA", "KEY_UP" ]; };       // maximize
          },
          {
            direction: "Down";
            mode: "OnRelease";
            action = { type: "Keypress"; keys: [ "KEY_LEFTMETA", "KEY_DOWN" ]; };     // minimize
          }
        );
      };
    },

    // Top (mode shift) button
    {
      cid: 0xc4;
      action = {
        type: "Gestures";
        gestures: (
          {
            direction: "None";
            mode: "OnRelease";
            action = { type: "ToggleSmartShift"; }; // toggle ratchet/free
          },
          {
            direction: "Up";
            mode: "OnRelease";
            action = { type: "ChangeDPI"; inc: 1000; };
          },
          {
            direction: "Down";
            mode: "OnRelease";
            action = { type: "ChangeDPI"; inc: -1000; };
          }
        );
      };
    }
  );
});

