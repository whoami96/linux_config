# ==========================================
#  tmux.conf — WhoAmI (Fedora 42, tmux 3.5a)
#  • Prefix: C-b / Alt prefix: C-a
#  • Nord theme
#  • Vim-style copy-mode + wl-copy
#  • Auto-save/restore sessions (resurrect)
#  • Plugins via TPM
# ==========================================

# --- Prefix keys ---
set -g prefix C-b
unbind C-b
bind C-b send-prefix
set -g prefix2 C-a
bind C-a send-prefix

# --- Terminal / colors / history ---
set -g default-terminal "tmux-256color"
set -as terminal-overrides ',*:Tc'
set -g history-limit 50000
set -g mouse on
set -g set-clipboard on
set -g focus-events on

# --- Indexes start at 1 ---
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# --- Splits & resize ---
bind | split-window -h
bind - split-window -v
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2

# --- Copy-mode (Vim style, Wayland clipboard) ---
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "wl-copy"
bind -T copy-mode-vi Y send -X copy-line
bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi / command-prompt -p "Search forward"  "send -X search-forward  '%%'"
bind -T copy-mode-vi ? command-prompt -p "Search backward" "send -X search-backward '%%'"
bind -T copy-mode-vi n send -X search-again
bind -T copy-mode-vi N send -X search-reverse

# --- QoL ---
bind r source-file ~/.tmux.conf \; display "Reloaded tmux.conf"
bind s setw synchronize-panes
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind Tab last-window
setw -g automatic-rename on
set  -g allow-rename off
setw -g monitor-activity on
set  -g visual-activity on

# --- Statusline (Nord) ---
set -g status-interval 5
set -g status-position bottom
set -g status-bg "#2E3440"
set -g status-fg "#D8DEE9"

set -g pane-border-style        fg="#4C566A"
set -g pane-active-border-style fg="#88C0D0"

# Left: session name
set -g status-left-length 40
set -g status-left '#[fg=#8FBCBB] #S #[fg=#81A1C1]| '

# Right: workdir | user | host | date time
set -g status-right-length 200
set -g status-right '#[fg=#81A1C1] #(basename "#{pane_current_path}") #[fg=#D8DEE9]| #[fg=#B48EAD] #(whoami) #[fg=#D8DEE9]| #[fg=#A3BE8C] #(cat ~/.box-name 2>/dev/null || hostname -s) #[fg=#D8DEE9]| #[fg=#EBCB8B]%Y-%m-%d #[fg=#88C0D0]%H:%M '

setw -g window-status-format         ' #[fg=#81A1C1]#I:#W '
setw -g window-status-current-format '#[fg=#2E3440,bg=#88C0D0] #I:#W #[default]'
setw -g window-status-activity-style fg="#EBCB8B",bold

# --- Plugins (TPM) ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'Morantron/tmux-fingers'
set -g @plugin 'christoomey/vim-tmux-navigator'

# --- Session save/restore (resurrect) ---
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @resurrect-dir '/home/whoami/.local/share/tmux/resurrect'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '10'
set -g @resurrect-capture-pane-contents 'on'
run-shell 'mkdir -p /home/whoami/.local/share/tmux/resurrect'

# Manual save/restore
bind C-s run-shell '~/.tmux/plugins/tmux-resurrect/scripts/save.sh'     \; display-message " Session saved"
bind C-r run-shell '~/.tmux/plugins/tmux-resurrect/scripts/restore.sh'  \; display-message "↩ Session restored"
bind S   run-shell '~/.tmux/plugins/tmux-resurrect/scripts/save.sh'     \; display-message " Session saved"
bind R   run-shell '~/.tmux/plugins/tmux-resurrect/scripts/restore.sh'  \; display-message "↩ Session restored"

# --- Search QoL ---
bind F command-prompt -I "" -p "Search" "copy-mode \; send -X search-forward '%%'"

# --- TPM init (must be at the end) ---
run '~/.tmux/plugins/tpm/tpm'
